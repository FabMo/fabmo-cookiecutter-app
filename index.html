<!DOCTYPE html>

<html lang="en"> 
<head>
	<title>Cookie Cutter</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8"/>
	<link href="css/style.css" rel="stylesheet">
	<script src="js/libs/jquery-1.11.2.min.js"></script>
	<script src="js/libs/fabmo.min.js"></script>
	<script src="js/libs/Sortable.min.js"></script>
	<script src="js/libs/fabmo.min.js"></script>

</head>

<body onload="">

<select id="job-group">
	<option id="group1">Group 1</option>
	<!--
	<option id="group2">Group 2</option>
	-->
</select>

<select id="addJob" autocomplete="off">
	<option value="add" selected disabled>+ Add Job</option>
	<!--
	<option value="computer" selected>Computer</option>
	-->
	<option value="history" selected>History</option>
	<!--
	<option value="queue">Queue</option>
	-->
</select>

<div id="recent-jobs">
	<li id="r0" data-id="r0" value="r0">partX</li>
	<li id="r1" data-id="r1" value="r1">partY</li>
	<li id="r2" data-id="r2" value="r2">partZ</li>
	<li id="r3" data-id="r3" value="r3">partA</li>
	<li id="r4" data-id="r4" value="r4">partB</li>	
	<p id="link" value="0">1 - 5 <a href="#" onclick="next()">next</a>
</div>

<div id="my-ui-list">
	<li id="default" data-id="default" value="default">drag and drop here</li>
	<li id="0" data-id="0" value="0">part0</li>
	<li id="1" data-id="1" value="1">part1</li>
	<li id="2" data-id="2" value="2">part2</li>
	<li id="3" data-id="3" value="3">part3</li>
	<li id="4" data-id="4" value="4">part4</li>
	<li id="5" data-id="5" value="5">part5</li>
	<li id="6" data-id="6" value="6">part6</li>
</div>

<div id="job-icons">
	<input class="trash" type="image" id="trash0" src="css/trash.png" onclick="removeJob(this.id)"/>
</div>

<div id="icons">
	<input type="image" id="new" src="css/new.png" onclick=""/>
	<input type="image" id="gear" src="css/gear.png" onclick=""/>
	<input type="image" id="play" src="css/play_icon.png" onclick="make()"/>
</div>

</body>

<script>

//TODO
//
//cleanup
//unique job list id
//fix select text
//configure history list
//create list
//save to the tool
//configure add & settings buttons (list/job name, color)
//

var fabmo = new FabMoDashboard()

var fabmoHistory = []
var fabmoQueue = []

var historyIndex = 0
var jobCount

var jobOrder = [0,1,2,3,4,5,6] 

var recentOrder = ['r0','r1','r2','r3','r4']

var list = document.getElementById("my-ui-list")

var jobHistory = document.getElementById("recent-jobs")

var sortable2 = new Sortable(jobHistory, {

	group: {name:"group1", pull: ['clone'], put: [false] },
	sort: false,
	animation: 250,
	onUpdate: function (e) {
		//console.log(e)
		//console.log(sortable2.toArray())
	},
	onSort: function (e) {
		//console.log(e)
		//console.log('2:')
		//console.log(sortable2.toArray())
	}

})

var sortable = new Sortable(list, {
	group:"group1",
	sort:true,
	animation: 250,
	onEnd: function(e){
		//console.log(e)
		//console.log(e.oldIndex)
		//console.log(e.newIndex)  
	},
	onAdd: function(e){
		//var itemEl = e.item;  // dragged HTMLElement
		//e.from;  // previous list
		// + indexes from onEnd
		console.log(e.item)
	},
	onSort: function(e){
		//console.log(e)
		jobOrder=sortable.toArray()
		//console.log(jobOrder)

		for(i=0;i<jobOrder.length;i++){
			if(jobOrder[i]=='default'){
				document.getElementById("default").remove()
				jobOrder.splice(i,1)
				document.getElementById("play").style.display="block"			
			}
		}
		console.log(jobOrder)
		sortable.sort(jobOrder)
		$("#job-icons").empty()
		//document.getElementById(jobOrder[0]).style.background = "#ffff55"
		for(i=0;i<jobOrder.length;i++){

			var top = i*70+105
			$("#job-icons").append("<input class=\"trash\" type=\"image\" id=\"trash" + jobOrder[i] + "\" style=\"top:" + top + "px\" src=\"css/trash.png\" onclick=\"removeJob(this.id)\"\/\>")
			$("#job-icons").append("<input class=\"gear\" type=\"image\" id=\"gear" + jobOrder[i] + "\" style=\"top:" + top + "px\" src=\"css/gear.png\" onclick=\"\"\/\>")

		}
		//console.log('1:')
		
	}

})

//sortable.sort(jobOrder)
document.getElementById("default").remove()

if(fabmo.isPresent()==true){

	$("#my-ui-list").empty()
	defaultDisplay()
	
	for(i=0;i<recentOrder.length;i++){
		document.getElementById(recentOrder[i]).remove();
	}
	document.getElementById("link").remove();

	fabmo.getJobHistory({start:0,count:5},function(err, myHistory) {
		fabmoHistory = myHistory
		console.log(fabmoHistory)

		if(fabmoHistory.data.length>0){
			for(i=0;i<fabmoHistory.data.length;i++){
				$("#recent-jobs").append("<li id=\"" + fabmoHistory.data[i]._id + "\" data-id=\"" + fabmoHistory.data[i]._id +"\" value=\"r4\">" + fabmoHistory.data[i].name + "</li>")
			}
			$("#recent-jobs").append("<p id=\"link\" value=\"" + historyIndex++ + "\">1 - 5 <a href=\"#\" onclick=\"next()\">next</a>")
		}
		else{
			console.log("no jobs in history")
		}
	})

}

for(i=1;i<jobOrder.length;i++){
	$("#job-icons").append("<input class=\"trash\" type=\"image\" id=\"trash" + i + "\" src=\"css/trash.png\" onclick=\"removeJob(this.id)\"\/\>")
	document.getElementById("trash"+i).style.top = i*70 + 105 + "px"

	$("#job-icons").append("<input class=\"gear\" type=\"image\" id=\"gear" + i + "\" src=\"css/gear.png\" onclick=\"\"\/\>")
	document.getElementById("gear"+i).style.top = i*70 + 105 + "px"
}


function removeJob(id){

	var remove = id.replace("trash", "")

	//document.getElementById(remove).remove();

	$("#my-ui-list").children("#" + remove).remove()

	$("#job-icons").empty()
	jobOrder=sortable.toArray()

	for(i=0;i<jobOrder.length;i++){
		var top = i*70+105
		$("#job-icons").append("<input class=\"trash\" type=\"image\" id=\"trash" + jobOrder[i] + "\" style=\"top:" + top + "px\" src=\"css/trash.png\" onclick=\"removeJob(this.id)\"\/\>")
		$("#job-icons").append("<input class=\"gear\" type=\"image\" id=\"gear" + jobOrder[i] + "\" style=\"top:" + top + "px\" src=\"css/gear.png\" onclick=\"\"\/\>")
	}
	if(jobOrder.length==0){
		defaultDisplay()
	}

}

function defaultDisplay(){
	jobOrder=['default']
	$("#job-icons").empty()
	$("#my-ui-list").append("<li id=\"default\" data-id=\"default\" value=\"default\">+ add job</li>")
	document.getElementById("default").style.background="#ff00ff"
	document.getElementById("play").style.display="none"
}

function next(){

	historyIndex++ 

	document.getElementById("link").remove();

	$("#recent-jobs").append("<p id=\"link\" value=\"" + historyIndex++ + "\">6 - 10 <a href=\"#\" onclick=\"next()\">next</a>")
	
}

function make(){

	//console.log(jobOrder[0])
	//console.log(jobOrder)

	//fabmo.runGCode("g0x0\n")

	fabmo.resubmitJob(jobOrder[0])

	jobOrder.push(jobOrder[0])
	jobOrder.splice(0,1)	
	sortable.sort(jobOrder)


}
</script>


</html>

